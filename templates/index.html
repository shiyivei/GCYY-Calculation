<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>心绪健康指数</title>
    <script src="/static/js/echarts.js"></script>
    <!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
    <script src="/static/js/d3.v4.min.js"></script>
    <script
      type="text/javascript"
      src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"
    ></script>
  </head>
  <body
    style="
      background-color: #000000;
      text-align: center;
    "
  >
    <div
      style="
        position: relative;
        top: 80px;
        color: white;
        font-size: 45px;
        font-family: Microsoft YaHei;
      "
    >
      GCYY 心绪指数
    </div>
    <div
      style="
        position: relative;
        top: 100px;
        color: rgb(153, 153, 153);
        font-size: 32px;
        font-family: Microsoft YaHei;
      "
    >
      Golden Centre of Yin & Yang
    </div>
    <div
      id="main"
      style="
        width: 900px;
        height: 850px;
        font-size: 12px;
        background-color: rgb(38, 38, 38);
        border-radius: 2em;
        position: relative;
        text-align: center;
        top: 140px;
        margin: 0 auto;
      "
    ></div>

    <div
      style="
        position: relative;
        top: 100px;
        width: 900px;
        margin: 0 auto;
      "
    >
      <div
        style="
          position: relative;
          text-align: left;
          left: 200px;
          color: white;
          font-size: 30px;
          /* background-color: rgb(9, 201, 89); */
          width: 300px;
          top: 90px;
        "
      >
        <img src="/static/img/lowpressure.png" />
        心率
      </div>
      <div
        style="
          position: relative;
          text-align: center;
          color: white;
          font-size: 30px;
          top: 50px;
          /* background-color: rgb(9, 201, 89); */
          width: 300px;
          left: 300px;
        "
      >
        <img src="/static/img/highpressure.png" />
        高压
      </div>
      <div
        style="
          position: relative;
          text-align: left;
          top: 43px;
          left: 500px;
          margin: 0 auto;
          color: white;
          font-size: 30px;
          top: 10px;
          /* background-color: rgb(9, 201, 89); */
          width: 300px;
          left: 280px;
        "
      >
        <img src="/static/img/heartbrate.png" />
        低压
      </div>
    </div>

    <br />

    <div
      id="main-2"
      style="
        width: 900px;
        height: 850px;
        font-size: 12px;
        background-color: rgb(38, 38, 38);
        border-radius: 2em;
        position: relative;
        text-align: center;
        top: 140px;
        margin: 0 auto;
      "
    ></div>

    <br />
    <br />
    <br />
    <br />
    <br />
    <br />

    <div
      style="
        text-align: left;
        font-size: 46px;
        width: 850px;
        height: 400px;
        margin: 0 auto;
        line-height: 70px;
        text-indent: 2em;
        color: rgb(255, 255, 255);
        position: relative;
        top: 170px;
      "
    >
      GCYY 全称为“Golden Centre of Yin & Yang”。
      中文全称为“心绪健康指数”。
      其计算源自非二科技首席算法科学家刘承宜教授独家专利授权算法。
      心绪健康指数基础原理来自韦伯费希纳定律与诺特定律，基本原理有两点:
      1,主观感受与客观参数成对数关系;
      2,有阴阳就一定有对称性。
      非二将连续的心率、血压等心绪管参数统一定量整合后，得出GCYY心绪健康指数，GCYY指数越高，心绪就越健康
    </div>
    <script>
      //   var oBtn = document.querySelector("button");
      //   oBtn.addEventListener("click", function () {
      //     console.log("---click1---");
      //     wx.miniProgram.navigateTo({
      //       url: "/path/to/page",
      //     });
      //     console.log("---click2---");
      //   });
      // function click(error, dalta) {
      //   wx.miniProgram.reLaunch({
      //     url: "https://www.baidu.com/",
      //   });
      // }
      var timeset = []; //数组初始化
      var data_heart = [];
      var data_pressure_low = [];
      var data_pressure_high = [];
      var data_rr = [];
      let data = [];
      //获取csv对象
      d3.csv(
        "/static/csv/{{personal_report}}",
        function (error, csvdata) {
          console.log("raw data:", csvdata);
          if (error) {
            console.log(error);
          } else {
            // debugger;
            for (
              var i = 0;
              i < csvdata.length;
              i++
            ) {
              timeset.push(
                new Date(csvdata[i].时间)
              );
              data.push([
                +new Date(
                  csvdata[i].time.replace(
                    /-/g,
                    "/"
                  )
                ),
                csvdata[i].GCYY * 100000,
              ]);
              data_heart.push([
                +new Date(
                  csvdata[i].time.replace(
                    /-/g,
                    "/"
                  )
                ),
                +csvdata[i].心率,
              ]);
              data_pressure_low.push([
                +new Date(
                  csvdata[i].time.replace(
                    /-/g,
                    "/"
                  )
                ),
                +csvdata[i].低压,
              ]);
              data_pressure_high.push([
                +new Date(
                  csvdata[i].time.replace(
                    /-/g,
                    "/"
                  )
                ),
                +csvdata[i].高压,
              ]);
              data_rr.push([
                +new Date(
                  csvdata[i].time.replace(
                    /-/g,
                    "/"
                  )
                ),
                +csvdata[i].RR,
              ]);
            }

            console.log(data_heart);

            var myChart = echarts.init(
              document.getElementById("main"),
              null,
              { renderer: "svg" }
            );
            var myChart2 = echarts.init(
              document.getElementById("main-2"),
              null,
              { renderer: "svg" }
            );

            option = {
              tooltip: {
                trigger: "axis",
                position: function (pt) {
                  return [pt[0], "10%"];
                },
              },

              // legend: {
              //   data: [
              //     "GCYY", // "RR",
              //   ],
              //   top: "4%",
              //   textStyle: {
              //     //图例文字的样式
              //     color: "#DEDEDE",
              //     fontSize: 20,
              //   },
              // },
              title: {
                left: "center",
                // text: "water_data_select_out - GCYY Chart",
                text: "",
              },
              toolbox: {
                feature: {
                  dataZoom: {
                    yAxisIndex: "none",
                  },
                  restore: {},
                  saveAsImage: {},
                },
              },
              xAxis: {
                type: "time",
                boundaryGap: false,
                axisLabel: {
                  fontSize: "20",
                  // fontFamily: "微软雅黑",
                  marginTop: "35px",
                  show: true,
                  color: "white",
                },
              },
              yAxis: {
                type: "value",
                boundaryGap: [0, "100%"],
                interval: 50,
                min: 900,
                max: 1600,
                axisLabel: {
                  fontSize: "20",
                  // fontFamily: "微软雅黑",
                  marginTop: "35px",
                  show: true,
                  color: "white",
                },
                splitLine: {
                  show: true,
                  lineStyle: {
                    color: "#999999",
                    width: 1,
                    type: "solid",
                  },
                },
              },
              // dataZoom: [
              //   {
              //     type: "inside",
              //     start: 0,
              //     end: 100,
              //   },
              //   {
              //     start: 0,
              //     end: 20,
              //   },
              // ],
              series: [
                {
                  name: "GCYY",
                  type: "line",
                  smooth: true,
                  symbol: "none",
                  // areaStyle: {},
                  data: data,
                  color: "white",

                  itemStyle: {
                    normal: {
                      lineStyle: {
                        color: "#47D7FF",
                      },
                    },
                  },
                },
              ],
            };

            option_2 = {
              tooltip: {
                trigger: "axis",
                position: function (pt) {
                  return [pt[0], "10%"];
                },
              },
              // title: {
              // 	left: 'center',
              // 	text: 'GCYY Chart'
              // },
              // legend: {
              //   data: [
              //     "心率",
              //     "低压",
              //     "高压",
              //     // "RR",
              //   ],
              //   top: "4%",
              //   title: {
              //     left: "center",
              //     // text: "water_data_select_out - GCYY Chart",
              //     text: "",
              //   },
              //   textStyle: {
              //     //图例文字的样式
              //     color: "#FFFFFF",
              //     fontSize: 28,
              //   },
              // },
              toolbox: {
                feature: {
                  dataZoom: {
                    yAxisIndex: "none",
                  },
                  restore: {},
                  saveAsImage: {},
                },
              },
              xAxis: {
                type: "time",
                boundaryGap: false,
                axisLabel: {
                  fontSize: "20",
                  // fontFamily: "微软雅黑",
                  marginTop: "35px",
                  show: true,
                  color: "white",
                },
              },
              yAxis: {
                type: "value",
                boundaryGap: [0, "100%"],
                interval: 10,
                min: 40,
                max: 160,
                axisLabel: {
                  fontSize: "20",
                  // fontFamily: "微软雅黑",
                  marginTop: "35px",
                  show: true,
                  color: "white",
                },
                splitLine: {
                  show: true,
                  lineStyle: {
                    color: "#999999",
                    width: 1,
                    type: "solid",
                  },
                },
              },
              // dataZoom: [
              //   {
              //     type: "inside",
              //     start: 0,
              //     end: 100,
              //   },
              //   {
              //     start: 0,
              //     end: 20,
              //   },
              // ],
              series: [
                {
                  name: "心率",
                  type: "line",
                  smooth: true,
                  symbol: "none",
                  // areaStyle: {},
                  data: data_heart,
                  itemStyle: {
                    normal: {
                      lineStyle: {
                        color: "#00FF7F",
                      },
                    },
                  },
                },
                {
                  name: "低压",
                  type: "line",
                  smooth: true,
                  symbol: "none",
                  // areaStyle: {},
                  data: data_pressure_low,
                  itemStyle: {
                    normal: {
                      lineStyle: {
                        color: "#BCBCBC",
                      },
                    },
                  },
                },
                {
                  name: "高压",
                  type: "line",
                  smooth: true,
                  symbol: "none",
                  // areaStyle: {},
                  data: data_pressure_high,
                  itemStyle: {
                    normal: {
                      lineStyle: {
                        color: "#A75EFF",
                      },
                    },
                  },
                },
                // {
                //   name: "RR",
                //   type: "line",
                //   smooth: true,
                //   symbol: "none",
                //   // areaStyle: {},
                //   data: data_rr,
                // },
              ],
            };

            // option = {
            // 	xAxis: {
            // 		type: 'category',
            // 		data: timeset
            // 	},
            // 	yAxis: {
            // 		type: 'value'
            // 	},
            // 	series: [
            // 		{
            // 		data: numset1,
            // 		type: 'line',
            // 		smooth: true
            // 		}
            // 	]
            // };

            myChart.setOption(option);
            myChart2.setOption(option_2);
            window.addEventListener(
              "resize",
              function () {
                myChart.resize();
              }
            );
            window.addEventListener(
              "resize",
              function () {
                barChart.resize();
              }
            );
          }
        }
      );
    </script>
  </body>
</html>
